---
title: "Practicum1"
author: "Thomas Faria"
date: "2024-06-05"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load required packages for Practicum1
library(tidyverse)
library(devtools)

```

## Part 1: Questions

### Question 1

```{r, q1}

```

### Question 2

```{r, q2}
doc_df[1, 2]
doc_df[2:4, ]
doc_df[, 4]
```

### Question 3

```{r, q3}

```

### Question 4

```{r}
summary(mtcars)

mpg_weight_cor <- mtcars %>%
select(wt, mpg) %>%
drop_na() %>%
summarize(correlation = cor(wt, mpg))
mpg_weight_cor
```

* It is known that the weight of a vehicle plays a key role in how fuel efficient it is, so both wt and mpg were selected to identify a potential correlation
* The Pearson coefficient is a descriptive statistic that reveals the linear correlation between two variables
* A value between 0 and 1 shows how strong the correlation is, with 1 indicating a strong correlation and 0 an absence of correlation
* The sign of the value indicates the type of correlation (positive or negative)

---

## Part 2: Practicum Tasks

#### Load data from provided URL

```{r, load_data}

# Documentation from data.world recommends package installation directly from Github
devtools::install_github("datadotworld/data.world-r", build_vignettes = TRUE)

# Load the requisite API token obtained from data.world advanced settings (Thomas's account)
token <- readLines('~/RStudioProjects/Summer24_DA5020_Group7_Practicum1/API_token')
saved_cfg <- data.world::save_config(token)
data.world::set_config(saved_cfg)

# From data.world R and RStudio integration:
library("data.world")
sql_stmt <- data.world::qry_sql("SELECT * FROM chemical_dependence_treatment_program_admissions_beginning_2007_1")
query_results_df <- data.world::query(
  sql_stmt, "https://data.world/data-ny-gov/ngbt-9rwf")

```

#### Initial evaluation of dataset

-   Determine necessary preparation steps and perform them

-   Discuss distribution, outliers, and prepare summary stats

```{r, q4}

# Evaluate data distribution, outliers, and prepare summary stats

# Reassign query results to more descriptive variable
admissions_data <- query_results_df

# Overview data
glimpse(admissions_data)
summary(admissions_data)

# Visualize outliers in the admissions column
ggplot(admissions_data) +
  labs(title = "Admissions Data Distribution") +
  geom_histogram(mapping = aes(x = admissions), bindwidth = 5)

# Zoom in on low occuring values
ggplot(admissions_data) +
  labs(title = "Admissions Data Distribution (< 8 occurences)") +
  geom_histogram(mapping = aes(x = admissions), binwidth = 5) +
  coord_cartesian(ylim = c(0,8))

# Designate all columns except for year, admissions, and county as categorical (using as.factor())
admissions_data_factors <- admissions_data %>% 
  mutate(
    program_category = as.factor(program_category),
    service_type = as.factor(service_type),
    age_group = as.factor(age_group),
    primary_substance_group = as.factor(primary_substance_group)
  )

# Compute summaries per factor
program_category_summary <- admissions_data_factors %>% 
  group_by(program_category) %>%
  summarize(
    min_admissions = min(admissions),
    median_admissions = median(admissions),
    mean_admissions = mean(admissions),
    max_admissions = max(admissions)
  )
service_type_summary <- admissions_data_factors %>% 
  group_by(service_type) %>%
  summarize(
    min_admissions = min(admissions),
    median_admissions = median(admissions),
    mean_admissions = mean(admissions),
    max_admissions = max(admissions)
  )
age_group_summary <- admissions_data_factors %>% 
  group_by(age_group) %>%
  summarize(
    min_admissions = min(admissions),
    median_admissions = median(admissions),
    mean_admissions = mean(admissions),
    max_admissions = max(admissions)
  )
primary_substance_group_summary <- admissions_data_factors %>% 
  group_by(primary_substance_group) %>%
  summarize(
    min_admissions = min(admissions),
    median_admissions = median(admissions),
    mean_admissions = mean(admissions),
    max_admissions = max(admissions)
  )

```

#### Restructure data into appropriate tibbles

```{r county}
# Temporary DF, query setup not working yet (for Caitlin)
temp_chem_df <- read.csv("chemical-dependence-treatment-program-admissions-for-55-and-older-beginning-2007-1.csv")
# Read in .csv created from https://www.dot.ny.gov/main/business-center/engineering/specifications/local-specifications/county-code as reference
county_codes <- read_csv("county_codes.csv") %>%
  rename(`County.of.Residence` = `County of Residence`)
county_codes
```

```{r county}
# Code if we want to keep abbreviations
county1 <- temp_chem_df %>%
  select(County.of.Residence) %>%
  distinct() %>%
  left_join(county_codes, by = "County.of.Residence") %>%
  mutate(`County Code` = case_when(
      # Tagging counties with first two characters and "-NYC"
      County.of.Residence %in% c("Bronx", "Queens", "Kings") ~ str_trim(paste(str_to_upper(str_sub(County.of.Residence, 1, 2)), "-NYC")),
      County.of.Residence == "New York" ~ "NYC",
      # Handle to not treat as NA value, changed code to NS instead
      County.of.Residence == "Nassau" ~ "NS",
      # Handle to not treat as NA value, manually assigned SL 
      County.of.Residence == "St Lawrence" ~ "SL",
      TRUE ~ `County Code` 
    )
  )
county1

# Code that assigns a unique numerical ID to counties
county2 <- temp_chem_df %>%
  select(County.of.Residence) %>%
  distinct() %>%
  left_join(county_codes, by = "County.of.Residence") %>%
  mutate(`County Code` = row_number())
county2
```

```{r, program_category}
# Sairah
```

```{r, primary_substance_group}
# Sairah
```

```{r, admissions_data}
# Thomas
```

#### Define annualAdmissions()

-   Function should derive the total \# of reported admissions per year for the entire state of NY and display these results on a line graph

-   Annotate to show year with highest admissions

-   Explain results

```{r, define_function}

```

#### Analyze % of admissions by county

-   Visualize top 5 counties using a bar chart

-   Explain results

```{r, admissions_by_county}

```

#### Extract various "Rehab" facilities information

-   Use a regex to match all facilities that include the word rehab, rehabilitation, etc.

-   Using filtered data, identify the most prominent (common) substance related to admission for each age group

-   Visualize and explain results

```{r, rehab_regex}

```
